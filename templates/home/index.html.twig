<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.1/css/dataTables.bootstrap5.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.3.2/css/buttons.bootstrap5.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.4.0/css/responsive.bootstrap5.min.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

<link rel="stylesheet" href={{asset('styles/app.css')}}>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js" integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script src="https://cdn.datatables.net/1.13.1/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.1/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.2/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.2/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.2/js/buttons.print.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.2/js/buttons.colVis.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/responsive/2.4.0/js/dataTables.responsive.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.4.0/js/responsive.bootstrap5.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

{% set counter = 0 %}

<script>
function format(gc_id, date, type, amount, note) {
    return "<div class='col-xs-offset-1'><b>GC ID:</b> "+gc_id+"</div><div class='col-xs-offset-1'><b>Date:</b>55555555555</div><div class='col-xs-offset-1'><b>Type:</b> tttttttt</div><div class='col-xs-offset-1'><b>Amount:</b>zzzzzzzzzzzzzz</div<div class='col-xs-offset-1'><b>Note:</b>nnnnnnnnnnnnnnn</div>";
};

	$(document).ready(function () {
var table = $('#tablePhones').DataTable({
//"dom": "<'row'<'col-sm-12 col-md-6'l><'col-sm-12 col-md-6'f>>" + "<'row'<'col-sm-12'tr>>" + "<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>",
fixedColumns: true,
//lengthChange: false,
buttons: ['copy', 'excel', 'pdf', 'colvis', 'add']


});
table.buttons().container()
        .appendTo( '#tablePhones_wrapper .col-md-6:eq(0)' );

	});
</script>


{% if employes is empty %}
	<h2>Pas encore d'employe !</h2>
{% else %}
	{# <h2>Il y a
			{{ employes|length }}
			employés</h2>
		<h3>Voici la liste</h3> #}
	<div id="divTable">
	
		<table id="tablePhones" class="table table-striped display" cellspacing="0">
			<thead>
				<tr>
					<th></th>
					<th></th>
					<th>Civilité</th>
					<th>Nom</th>
					<th>Prénom</th>
					<th>Email</th>
					<th>Terminal Communiquant</th>
					<th>IMEI Communiquant</th>
					<th>IMEI Acheté</th>
					<th>Mise en service</th>
					<th>Reference</th>
					
					<th class="hidden">Fin engagement</th>
					<th class="hidden">Facturation</th>
					<th class="hidden">Portage</th> 
					<th class="hidden">CSIM</th>
					<th class="hidden">NumeroPrive</th> 
					<th class="hidden">ChangementTerminal</th>
					<th class="hidden">Modification forfait</th>
					<th class="hidden">Ligne secondaire</th>
					<th class="hidden">Ligne principale</th>
					<th class="hidden">MIA</th>
					<th class="hidden">Forfait</th>
					<th class="hidden">Liste</th>				
				</tr>
			</thead>
			<tbody>
				
				{% set counter = -1 %}
				{% for item in attributions %}
					<tr>
						<td class='details-control'></td>
						<td><input type="checkbox" class="form-check-input" name="" id=""></td>
						<td>{{item.civilite}}</td>
						<td>{{item.Nom}}</td>
						<td>{{item.Prenom}}</td>
						<td>{{item.Email}}</td>
						<td>{{item.communiquant}}</td>
						<td>{{item.imeiCommuniquant}}</td>
						<td>{{item.imeiAchete}}</td>
						<td>{{item.miseService}}</td>
						<td>{{item.reference}}</td>
						<td class="hidden">{{item.finEngagement}}</td>
						<td class="hidden">{{item.facturation}}</td>
						<td class="hidden">{{item.portage}}</td> 
						<td class="hidden">{{item.csim}}</td>
						<td class="hidden">{{item.numeroPrive}}</td>
						<td class="hidden">{{item.changementTerminal}}</td> 
						<td class="hidden">{{item.modificationForfait}}</td>
						<td class="hidden">{{item.ligneSecondaire}}</td>
						<td class="hidden">{{item.lignePrincipale}}</td>
						<td class="hidden">{{item.masterIdAcces}}</td>
						<td class="hidden">{{item.libelle}}</td>
						<td class="hidden"></td>
						
					
					</tr>
					{% set counter = counter + 1 %}
				{% endfor %}
				
				{% block javascripts %}
							<script>
								
									$('#tablePhones tbody').on('click', 'td.details-control', function () {
										var tr = $(this).closest('tr');
										var table = $('#tablePhones').DataTable();
										var row = table.row(tr);
										if (row.child.isShown()) {
											console.log("shown")
											row.child.hide();
											tr.removeClass('shown');
										} else {
											// Open this row
											console.log("not shown")
											row.child(format("{{attributions[counter].Nom}}")).show();
											tr.addClass('shown');

										}
									});
							
							</script>
						
				{% endblock %}
			</tbody>
		</table>
		<div class="containerAlerte">
			<div>Terminaux disponibles :
				{{terminauxRestants}}
				/
				{{totalTerminaux}}</div>
			{% if terminauxRestants >= totalTerminaux / 4 %}
				<div class="alerte alerteVerte"></div>
				<div class="texteVert">Il reste suffisamment de terminaux disponibles.</div>
			{% elseif terminauxRestants < totalTerminaux / 4 and terminauxRestants > totalTerminaux / 10 %}
				<div class="alerte alerteJaune"></div>
				<div class="texteJaune">Il ne reste plus beaucoup de terminaux disponibles.</div>
			{% else %}
				<div class="alerte alerteRouge"></div>
				<div class="texteRouge">Un renouvellement du stock est nécessaire.</div>
			{% endif %}
			


		</div>
	</div>

{% endif %}

{# FORM LIGNE #}
<!-- Button trigger modal -->
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
  Nouvelle ligne
</button>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="formLigne">
        {{form_start(form)}}
		{{form_widget(form)}}
		{{form_end(form)}}
      </div>
    </div>
  </div>
</div>

{# {% block javascripts %}
	<script>
		$('#tablePhones_wrapper').ready({
			$('#tablePhones_wrapper').append('<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">Nouvelle ligne</button>');
		});
	</script>
{% endblock %} #}

{# FORM EMPLOYE #}
<!-- Button trigger modal -->
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModalE">
  Nouvel employe
</button>

<!-- Modal -->
<div class="modal fade" id="exampleModalE" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        {{form_start(formEmploye)}}
		{{form_widget(formEmploye)}}
		{{form_end(formEmploye)}}
      </div>
    </div>
  </div>
</div>

{# FORM TERMINAL #}
<!-- Button trigger modal -->
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModalT">
  Nouveau terminal
</button>

<!-- Modal -->
<div class="modal fade" id="exampleModalT" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        {{form_start(formTerminal)}}
		{{form_widget(formTerminal)}}
		{{form_end(formTerminal)}}
      </div>
    </div>
  </div>
</div>

{# FORM ATTRIBUTION #}
<!-- Button trigger modal -->
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModalA">
  Nouvel attribution
</button>

<!-- Modal -->
<div class="modal fade" id="exampleModalA" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        {{form_start(formAttribution)}}
		{{form_widget(formAttribution)}}
		{{form_end(formAttribution)}}
      </div>
    </div>
  </div>
</div>


<script src={{asset('scripts/front.js')}}></script>
